/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { CardViewTextItemModel, CardViewBoolItemModel, CardViewDateItemModel, CardViewDatetimeItemModel, CardViewIntItemModel, CardViewFloatItemModel, LogService, MultiValuePipe, AppConfigService, DecimalNumberPipe } from '@alfresco/adf-core';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
/** @type {?} */
const D_TEXT = 'd:text';
/** @type {?} */
const D_MLTEXT = 'd:mltext';
/** @type {?} */
const D_DATE = 'd:date';
/** @type {?} */
const D_DATETIME = 'd:datetime';
/** @type {?} */
const D_INT = 'd:int';
/** @type {?} */
const D_LONG = 'd:long';
/** @type {?} */
const D_FLOAT = 'd:float';
/** @type {?} */
const D_DOUBLE = 'd:double';
/** @type {?} */
const D_BOOLEAN = 'd:boolean';
export class PropertyGroupTranslatorService {
    /**
     * @param {?} logService
     * @param {?} multiValuePipe
     * @param {?} decimalNumberPipe
     * @param {?} appConfig
     */
    constructor(logService, multiValuePipe, decimalNumberPipe, appConfig) {
        this.logService = logService;
        this.multiValuePipe = multiValuePipe;
        this.decimalNumberPipe = decimalNumberPipe;
        this.appConfig = appConfig;
        this.valueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator');
    }
    /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    translateToCardViewGroups(propertyGroups, propertyValues) {
        return propertyGroups.map((/**
         * @param {?} propertyGroup
         * @return {?}
         */
        (propertyGroup) => {
            /** @type {?} */
            const translatedPropertyGroup = Object.assign({}, propertyGroup);
            translatedPropertyGroup.properties = this.translateArray(propertyGroup.properties, propertyValues);
            return translatedPropertyGroup;
        }));
    }
    /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    translateArray(properties, propertyValues) {
        return properties.map((/**
         * @param {?} property
         * @return {?}
         */
        (property) => {
            return this.translate(property, propertyValues);
        }));
    }
    /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    translate(property, propertyValues) {
        /** @type {?} */
        let propertyValue;
        if (propertyValues && propertyValues[property.name]) {
            propertyValue = propertyValues[property.name];
        }
        this.checkECMTypeValidity(property.dataType);
        /** @type {?} */
        const prefix = 'properties.';
        /** @type {?} */
        const propertyDefinition = {
            label: property.title || property.name,
            value: propertyValue,
            key: `${prefix}${property.name}`,
            default: property.defaultValue,
            editable: true
        };
        /** @type {?} */
        let cardViewItemProperty;
        switch (property.dataType) {
            case D_MLTEXT:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multiline: true
                }));
                break;
            case D_INT:
            case D_LONG:
                cardViewItemProperty = new CardViewIntItemModel(propertyDefinition);
                break;
            case D_FLOAT:
            case D_DOUBLE:
                cardViewItemProperty = new CardViewFloatItemModel(Object.assign(propertyDefinition, {
                    pipes: [{ pipe: this.decimalNumberPipe }]
                }));
                break;
            case D_DATE:
                cardViewItemProperty = new CardViewDateItemModel(propertyDefinition);
                break;
            case D_DATETIME:
                cardViewItemProperty = new CardViewDatetimeItemModel(propertyDefinition);
                break;
            case D_BOOLEAN:
                cardViewItemProperty = new CardViewBoolItemModel(propertyDefinition);
                break;
            case D_TEXT:
            default:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multivalued: property.multiValued,
                    multiline: property.multiValued,
                    pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                }));
        }
        return cardViewItemProperty;
    }
    /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    checkECMTypeValidity(ecmPropertyType) {
        if (PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES.indexOf(ecmPropertyType) === -1) {
            this.logService.error(`Unknown type for mapping: ${ecmPropertyType}`);
        }
    }
}
PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES = [D_TEXT, D_MLTEXT, D_DATE, D_DATETIME, D_INT, D_LONG, D_FLOAT, D_DOUBLE, D_BOOLEAN];
PropertyGroupTranslatorService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
PropertyGroupTranslatorService.ctorParameters = () => [
    { type: LogService },
    { type: MultiValuePipe },
    { type: DecimalNumberPipe },
    { type: AppConfigService }
];
/** @nocollapse */ PropertyGroupTranslatorService.ngInjectableDef = i0.defineInjectable({ factory: function PropertyGroupTranslatorService_Factory() { return new PropertyGroupTranslatorService(i0.inject(i1.LogService), i0.inject(i1.MultiValuePipe), i0.inject(i1.DecimalNumberPipe), i0.inject(i1.AppConfigService)); }, token: PropertyGroupTranslatorService, providedIn: "root" });
if (false) {
    /** @type {?} */
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES;
    /** @type {?} */
    PropertyGroupTranslatorService.prototype.valueSeparator;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.multiValuePipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.decimalNumberPipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImNvbnRlbnQtbWV0YWRhdGEvc2VydmljZXMvcHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFHSCxxQkFBcUIsRUFDckIscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix5QkFBeUIsRUFDekIsb0JBQW9CLEVBQ3BCLHNCQUFzQixFQUN0QixVQUFVLEVBQ1YsY0FBYyxFQUNkLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDcEIsTUFBTSxvQkFBb0IsQ0FBQzs7OztNQUd0QixNQUFNLEdBQUcsUUFBUTs7TUFDakIsUUFBUSxHQUFHLFVBQVU7O01BQ3JCLE1BQU0sR0FBRyxRQUFROztNQUNqQixVQUFVLEdBQUcsWUFBWTs7TUFDekIsS0FBSyxHQUFHLE9BQU87O01BQ2YsTUFBTSxHQUFHLFFBQVE7O01BQ2pCLE9BQU8sR0FBRyxTQUFTOztNQUNuQixRQUFRLEdBQUcsVUFBVTs7TUFDckIsU0FBUyxHQUFHLFdBQVc7QUFLN0IsTUFBTSxPQUFPLDhCQUE4Qjs7Ozs7OztJQU12QyxZQUFvQixVQUFzQixFQUN0QixjQUE4QixFQUM5QixpQkFBb0MsRUFDcEMsU0FBMkI7UUFIM0IsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUN0QixtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUMzQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFTLDZDQUE2QyxDQUFDLENBQUM7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SyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEVBQUMsQ0FBQztpQkFDdkUsQ0FBQyxDQUFDLENBQUM7U0FDWDtRQUVELE9BQU8sb0JBQW9CLENBQUM7SUFDaEMsQ0FBQzs7Ozs7O0lBRU8sb0JBQW9CLENBQUMsZUFBZTtRQUN4QyxJQUFJLDhCQUE4QixDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRTtZQUNyRixJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsZUFBZSxFQUFFLENBQUMsQ0FBQztTQUN6RTtJQUNMLENBQUM7O0FBNUZlLG1EQUFvQixHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQzs7WUFMOUgsVUFBVSxTQUFDO2dCQUNSLFVBQVUsRUFBRSxNQUFNO2FBQ3JCOzs7O1lBbkJHLFVBQVU7WUFDVixjQUFjO1lBRWQsaUJBQWlCO1lBRGpCLGdCQUFnQjs7Ozs7SUFvQmhCLG9EQUEySDs7SUFFM0gsd0RBQXVCOzs7OztJQUVYLG9EQUE4Qjs7Ozs7SUFDOUIsd0RBQXNDOzs7OztJQUN0QywyREFBNEM7Ozs7O0lBQzVDLG1EQUFtQyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEFsZnJlc2NvIFNvZnR3YXJlLCBMdGQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gICAgQ2FyZFZpZXdJdGVtUHJvcGVydGllcyxcbiAgICBDYXJkVmlld0l0ZW0sXG4gICAgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsLFxuICAgIENhcmRWaWV3Qm9vbEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0RhdGVJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0ludEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0Zsb2F0SXRlbU1vZGVsLFxuICAgIExvZ1NlcnZpY2UsXG4gICAgTXVsdGlWYWx1ZVBpcGUsXG4gICAgQXBwQ29uZmlnU2VydmljZSxcbiAgICBEZWNpbWFsTnVtYmVyUGlwZVxufSBmcm9tICdAYWxmcmVzY28vYWRmLWNvcmUnO1xuaW1wb3J0IHsgUHJvcGVydHksIENhcmRWaWV3R3JvdXAsIE9yZ2FuaXNlZFByb3BlcnR5R3JvdXAgfSBmcm9tICcuLi9pbnRlcmZhY2VzL2NvbnRlbnQtbWV0YWRhdGEuaW50ZXJmYWNlcyc7XG5cbmNvbnN0IERfVEVYVCA9ICdkOnRleHQnO1xuY29uc3QgRF9NTFRFWFQgPSAnZDptbHRleHQnO1xuY29uc3QgRF9EQVRFID0gJ2Q6ZGF0ZSc7XG5jb25zdCBEX0RBVEVUSU1FID0gJ2Q6ZGF0ZXRpbWUnO1xuY29uc3QgRF9JTlQgPSAnZDppbnQnO1xuY29uc3QgRF9MT05HID0gJ2Q6bG9uZyc7XG5jb25zdCBEX0ZMT0FUID0gJ2Q6ZmxvYXQnO1xuY29uc3QgRF9ET1VCTEUgPSAnZDpkb3VibGUnO1xuY29uc3QgRF9CT09MRUFOID0gJ2Q6Ym9vbGVhbic7XG5cbkBJbmplY3RhYmxlKHtcbiAgICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUHJvcGVydHlHcm91cFRyYW5zbGF0b3JTZXJ2aWNlIHtcblxuICAgIHN0YXRpYyByZWFkb25seSBSRUNPR05JU0VEX0VDTV9UWVBFUyA9IFtEX1RFWFQsIERfTUxURVhULCBEX0RBVEUsIERfREFURVRJTUUsIERfSU5ULCBEX0xPTkcsIERfRkxPQVQsIERfRE9VQkxFLCBEX0JPT0xFQU5dO1xuXG4gICAgdmFsdWVTZXBhcmF0b3I6IHN0cmluZztcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbG9nU2VydmljZTogTG9nU2VydmljZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIG11bHRpVmFsdWVQaXBlOiBNdWx0aVZhbHVlUGlwZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGRlY2ltYWxOdW1iZXJQaXBlOiBEZWNpbWFsTnVtYmVyUGlwZSxcbiAgICAgICAgICAgICAgICBwcml2YXRlIGFwcENvbmZpZzogQXBwQ29uZmlnU2VydmljZSkge1xuICAgICAgICB0aGlzLnZhbHVlU2VwYXJhdG9yID0gdGhpcy5hcHBDb25maWcuZ2V0PHN0cmluZz4oJ2NvbnRlbnQtbWV0YWRhdGEubXVsdGktdmFsdWUtcGlwZS1zZXBhcmF0b3InKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgdHJhbnNsYXRlVG9DYXJkVmlld0dyb3Vwcyhwcm9wZXJ0eUdyb3VwczogT3JnYW5pc2VkUHJvcGVydHlHcm91cFtdLCBwcm9wZXJ0eVZhbHVlcyk6IENhcmRWaWV3R3JvdXBbXSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0eUdyb3Vwcy5tYXAoKHByb3BlcnR5R3JvdXApID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwOiBhbnkgPSBPYmplY3QuYXNzaWduKHt9LCBwcm9wZXJ0eUdyb3VwKTtcbiAgICAgICAgICAgIHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXMgPSB0aGlzLnRyYW5zbGF0ZUFycmF5KHByb3BlcnR5R3JvdXAucHJvcGVydGllcywgcHJvcGVydHlWYWx1ZXMpO1xuICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWRQcm9wZXJ0eUdyb3VwO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYW5zbGF0ZUFycmF5KHByb3BlcnRpZXM6IFByb3BlcnR5W10sIHByb3BlcnR5VmFsdWVzOiBhbnkpOiBDYXJkVmlld0l0ZW1bXSB7XG4gICAgICAgIHJldHVybiBwcm9wZXJ0aWVzLm1hcCgocHJvcGVydHkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZShwcm9wZXJ0eSwgcHJvcGVydHlWYWx1ZXMpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHRyYW5zbGF0ZShwcm9wZXJ0eTogUHJvcGVydHksIHByb3BlcnR5VmFsdWVzOiBhbnkpOiBDYXJkVmlld0l0ZW0ge1xuICAgICAgICBsZXQgcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgaWYgKHByb3BlcnR5VmFsdWVzICYmIHByb3BlcnR5VmFsdWVzW3Byb3BlcnR5Lm5hbWVdKSB7XG4gICAgICAgICAgICBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlWYWx1ZXNbcHJvcGVydHkubmFtZV07XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNoZWNrRUNNVHlwZVZhbGlkaXR5KHByb3BlcnR5LmRhdGFUeXBlKTtcblxuICAgICAgICBjb25zdCBwcmVmaXggPSAncHJvcGVydGllcy4nO1xuXG4gICAgICAgIGNvbnN0IHByb3BlcnR5RGVmaW5pdGlvbjogQ2FyZFZpZXdJdGVtUHJvcGVydGllcyA9IHtcbiAgICAgICAgICAgIGxhYmVsOiBwcm9wZXJ0eS50aXRsZSB8fCBwcm9wZXJ0eS5uYW1lLFxuICAgICAgICAgICAgdmFsdWU6IHByb3BlcnR5VmFsdWUsXG4gICAgICAgICAgICBrZXk6IGAke3ByZWZpeH0ke3Byb3BlcnR5Lm5hbWV9YCxcbiAgICAgICAgICAgIGRlZmF1bHQ6IHByb3BlcnR5LmRlZmF1bHRWYWx1ZSxcbiAgICAgICAgICAgIGVkaXRhYmxlOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIGxldCBjYXJkVmlld0l0ZW1Qcm9wZXJ0eTtcblxuICAgICAgICBzd2l0Y2ggKHByb3BlcnR5LmRhdGFUeXBlKSB7XG5cbiAgICAgICAgICAgIGNhc2UgRF9NTFRFWFQ6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKE9iamVjdC5hc3NpZ24ocHJvcGVydHlEZWZpbml0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpbGluZTogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0lOVDpcbiAgICAgICAgICAgIGNhc2UgRF9MT05HOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3SW50SXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9GTE9BVDpcbiAgICAgICAgICAgIGNhc2UgRF9ET1VCTEU6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdGbG9hdEl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICBwaXBlczogW3sgcGlwZTogdGhpcy5kZWNpbWFsTnVtYmVyUGlwZSB9XVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX0RBVEU6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9EQVRFVElNRTpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0RhdGV0aW1lSXRlbU1vZGVsKHByb3BlcnR5RGVmaW5pdGlvbik7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9CT09MRUFOOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3Qm9vbEl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfVEVYVDpcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdUZXh0SXRlbU1vZGVsKE9iamVjdC5hc3NpZ24ocHJvcGVydHlEZWZpbml0aW9uLCB7XG4gICAgICAgICAgICAgICAgICAgIG11bHRpdmFsdWVkOiBwcm9wZXJ0eS5tdWx0aVZhbHVlZCxcbiAgICAgICAgICAgICAgICAgICAgbXVsdGlsaW5lOiBwcm9wZXJ0eS5tdWx0aVZhbHVlZCxcbiAgICAgICAgICAgICAgICAgICAgcGlwZXM6IFt7IHBpcGU6IHRoaXMubXVsdGlWYWx1ZVBpcGUsIHBhcmFtczogW3RoaXMudmFsdWVTZXBhcmF0b3JdfV1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2FyZFZpZXdJdGVtUHJvcGVydHk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0VDTVR5cGVWYWxpZGl0eShlY21Qcm9wZXJ0eVR5cGUpIHtcbiAgICAgICAgaWYgKFByb3BlcnR5R3JvdXBUcmFuc2xhdG9yU2VydmljZS5SRUNPR05JU0VEX0VDTV9UWVBFUy5pbmRleE9mKGVjbVByb3BlcnR5VHlwZSkgPT09IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ1NlcnZpY2UuZXJyb3IoYFVua25vd24gdHlwZSBmb3IgbWFwcGluZzogJHtlY21Qcm9wZXJ0eVR5cGV9YCk7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXX0=