/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Injectable } from '@angular/core';
import { CardViewTextItemModel, CardViewBoolItemModel, CardViewDateItemModel, CardViewDatetimeItemModel, CardViewIntItemModel, CardViewFloatItemModel, LogService, MultiValuePipe, AppConfigService, DecimalNumberPipe } from '@alfresco/adf-core';
import * as i0 from "@angular/core";
import * as i1 from "@alfresco/adf-core";
/** @type {?} */
var D_TEXT = 'd:text';
/** @type {?} */
var D_MLTEXT = 'd:mltext';
/** @type {?} */
var D_DATE = 'd:date';
/** @type {?} */
var D_DATETIME = 'd:datetime';
/** @type {?} */
var D_INT = 'd:int';
/** @type {?} */
var D_LONG = 'd:long';
/** @type {?} */
var D_FLOAT = 'd:float';
/** @type {?} */
var D_DOUBLE = 'd:double';
/** @type {?} */
var D_BOOLEAN = 'd:boolean';
var PropertyGroupTranslatorService = /** @class */ (function () {
    function PropertyGroupTranslatorService(logService, multiValuePipe, decimalNumberPipe, appConfig) {
        this.logService = logService;
        this.multiValuePipe = multiValuePipe;
        this.decimalNumberPipe = decimalNumberPipe;
        this.appConfig = appConfig;
        this.valueSeparator = this.appConfig.get('content-metadata.multi-value-pipe-separator');
    }
    /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translateToCardViewGroups = /**
     * @param {?} propertyGroups
     * @param {?} propertyValues
     * @return {?}
     */
    function (propertyGroups, propertyValues) {
        var _this = this;
        return propertyGroups.map((/**
         * @param {?} propertyGroup
         * @return {?}
         */
        function (propertyGroup) {
            /** @type {?} */
            var translatedPropertyGroup = Object.assign({}, propertyGroup);
            translatedPropertyGroup.properties = _this.translateArray(propertyGroup.properties, propertyValues);
            return translatedPropertyGroup;
        }));
    };
    /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translateArray = /**
     * @private
     * @param {?} properties
     * @param {?} propertyValues
     * @return {?}
     */
    function (properties, propertyValues) {
        var _this = this;
        return properties.map((/**
         * @param {?} property
         * @return {?}
         */
        function (property) {
            return _this.translate(property, propertyValues);
        }));
    };
    /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.translate = /**
     * @private
     * @param {?} property
     * @param {?} propertyValues
     * @return {?}
     */
    function (property, propertyValues) {
        /** @type {?} */
        var propertyValue;
        if (propertyValues && propertyValues[property.name]) {
            propertyValue = propertyValues[property.name];
        }
        this.checkECMTypeValidity(property.dataType);
        /** @type {?} */
        var prefix = 'properties.';
        /** @type {?} */
        var propertyDefinition = {
            label: property.title || property.name,
            value: propertyValue,
            key: "" + prefix + property.name,
            default: property.defaultValue,
            editable: true
        };
        /** @type {?} */
        var cardViewItemProperty;
        switch (property.dataType) {
            case D_MLTEXT:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multiline: true
                }));
                break;
            case D_INT:
            case D_LONG:
                cardViewItemProperty = new CardViewIntItemModel(propertyDefinition);
                break;
            case D_FLOAT:
            case D_DOUBLE:
                cardViewItemProperty = new CardViewFloatItemModel(Object.assign(propertyDefinition, {
                    pipes: [{ pipe: this.decimalNumberPipe }]
                }));
                break;
            case D_DATE:
                cardViewItemProperty = new CardViewDateItemModel(propertyDefinition);
                break;
            case D_DATETIME:
                cardViewItemProperty = new CardViewDatetimeItemModel(propertyDefinition);
                break;
            case D_BOOLEAN:
                cardViewItemProperty = new CardViewBoolItemModel(propertyDefinition);
                break;
            case D_TEXT:
            default:
                cardViewItemProperty = new CardViewTextItemModel(Object.assign(propertyDefinition, {
                    multivalued: property.multiValued,
                    multiline: property.multiValued,
                    pipes: [{ pipe: this.multiValuePipe, params: [this.valueSeparator] }]
                }));
        }
        return cardViewItemProperty;
    };
    /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    PropertyGroupTranslatorService.prototype.checkECMTypeValidity = /**
     * @private
     * @param {?} ecmPropertyType
     * @return {?}
     */
    function (ecmPropertyType) {
        if (PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES.indexOf(ecmPropertyType) === -1) {
            this.logService.error("Unknown type for mapping: " + ecmPropertyType);
        }
    };
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES = [D_TEXT, D_MLTEXT, D_DATE, D_DATETIME, D_INT, D_LONG, D_FLOAT, D_DOUBLE, D_BOOLEAN];
    PropertyGroupTranslatorService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    PropertyGroupTranslatorService.ctorParameters = function () { return [
        { type: LogService },
        { type: MultiValuePipe },
        { type: DecimalNumberPipe },
        { type: AppConfigService }
    ]; };
    /** @nocollapse */ PropertyGroupTranslatorService.ngInjectableDef = i0.defineInjectable({ factory: function PropertyGroupTranslatorService_Factory() { return new PropertyGroupTranslatorService(i0.inject(i1.LogService), i0.inject(i1.MultiValuePipe), i0.inject(i1.DecimalNumberPipe), i0.inject(i1.AppConfigService)); }, token: PropertyGroupTranslatorService, providedIn: "root" });
    return PropertyGroupTranslatorService;
}());
export { PropertyGroupTranslatorService };
if (false) {
    /** @type {?} */
    PropertyGroupTranslatorService.RECOGNISED_ECM_TYPES;
    /** @type {?} */
    PropertyGroupTranslatorService.prototype.valueSeparator;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.logService;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.multiValuePipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.decimalNumberPipe;
    /**
     * @type {?}
     * @private
     */
    PropertyGroupTranslatorService.prototype.appConfig;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BhbGZyZXNjby9hZGYtY29udGVudC1zZXJ2aWNlcy8iLCJzb3VyY2VzIjpbImNvbnRlbnQtbWV0YWRhdGEvc2VydmljZXMvcHJvcGVydHktZ3JvdXBzLXRyYW5zbGF0b3Iuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFHSCxxQkFBcUIsRUFDckIscUJBQXFCLEVBQ3JCLHFCQUFxQixFQUNyQix5QkFBeUIsRUFDekIsb0JBQW9CLEVBQ3BCLHNCQUFzQixFQUN0QixVQUFVLEVBQ1YsY0FBYyxFQUNkLGdCQUFnQixFQUNoQixpQkFBaUIsRUFDcEIsTUFBTSxvQkFBb0IsQ0FBQzs7OztJQUd0QixNQUFNLEdBQUcsUUFBUTs7SUFDakIsUUFBUSxHQUFHLFVBQVU7O0lBQ3JCLE1BQU0sR0FBRyxRQUFROztJQUNqQixVQUFVLEdBQUcsWUFBWTs7SUFDekIsS0FBSyxHQUFHLE9BQU87O0lBQ2YsTUFBTSxHQUFHLFFBQVE7O0lBQ2pCLE9BQU8sR0FBRyxTQUFTOztJQUNuQixRQUFRLEdBQUcsVUFBVTs7SUFDckIsU0FBUyxHQUFHLFdBQVc7QUFFN0I7SUFTSSx3Q0FBb0IsVUFBc0IsRUFDdEIsY0FBOEIsRUFDOUIsaUJBQW9DLEVBQ3BDLFNBQTJCO1FBSDNCLGVBQVUsR0FBVixVQUFVLENBQVk7UUFDdEIsbUJBQWMsR0FBZCxjQUFjLENBQWdCO1FBQzlCLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0MsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBUyw2Q0FBNkMsQ0FBQyxDQUFDO0lBQ3BHLENBQUM7Ozs7OztJQUVNLGtF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O29CQUMvQixLQUFLLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYyxFQUFFLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBQyxDQUFDO2lCQUN2RSxDQUFDLENBQUMsQ0FBQztTQUNYO1FBRUQsT0FBTyxvQkFBb0IsQ0FBQztJQUNoQyxDQUFDOzs7Ozs7SUFFTyw2REFBb0I7Ozs7O0lBQTVCLFVBQTZCLGVBQWU7UUFDeEMsSUFBSSw4QkFBOEIsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUU7WUFDckYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsK0JBQTZCLGVBQWlCLENBQUMsQ0FBQztTQUN6RTtJQUNMLENBQUM7SUE1RmUsbURBQW9CLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDOztnQkFMOUgsVUFBVSxTQUFDO29CQUNSLFVBQVUsRUFBRSxNQUFNO2lCQUNyQjs7OztnQkFuQkcsVUFBVTtnQkFDVixjQUFjO2dCQUVkLGlCQUFpQjtnQkFEakIsZ0JBQWdCOzs7eUNBN0JwQjtDQThJQyxBQWxHRCxJQWtHQztTQS9GWSw4QkFBOEI7OztJQUV2QyxvREFBMkg7O0lBRTNILHdEQUF1Qjs7Ozs7SUFFWCxvREFBOEI7Ozs7O0lBQzlCLHdEQUFzQzs7Ozs7SUFDdEMsMkRBQTRDOzs7OztJQUM1QyxtREFBbUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBBbGZyZXNjbyBTb2Z0d2FyZSwgTHRkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICAgIENhcmRWaWV3SXRlbVByb3BlcnRpZXMsXG4gICAgQ2FyZFZpZXdJdGVtLFxuICAgIENhcmRWaWV3VGV4dEl0ZW1Nb2RlbCxcbiAgICBDYXJkVmlld0Jvb2xJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdEYXRlSXRlbU1vZGVsLFxuICAgIENhcmRWaWV3RGF0ZXRpbWVJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdJbnRJdGVtTW9kZWwsXG4gICAgQ2FyZFZpZXdGbG9hdEl0ZW1Nb2RlbCxcbiAgICBMb2dTZXJ2aWNlLFxuICAgIE11bHRpVmFsdWVQaXBlLFxuICAgIEFwcENvbmZpZ1NlcnZpY2UsXG4gICAgRGVjaW1hbE51bWJlclBpcGVcbn0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFByb3BlcnR5LCBDYXJkVmlld0dyb3VwLCBPcmdhbmlzZWRQcm9wZXJ0eUdyb3VwIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy9jb250ZW50LW1ldGFkYXRhLmludGVyZmFjZXMnO1xuXG5jb25zdCBEX1RFWFQgPSAnZDp0ZXh0JztcbmNvbnN0IERfTUxURVhUID0gJ2Q6bWx0ZXh0JztcbmNvbnN0IERfREFURSA9ICdkOmRhdGUnO1xuY29uc3QgRF9EQVRFVElNRSA9ICdkOmRhdGV0aW1lJztcbmNvbnN0IERfSU5UID0gJ2Q6aW50JztcbmNvbnN0IERfTE9ORyA9ICdkOmxvbmcnO1xuY29uc3QgRF9GTE9BVCA9ICdkOmZsb2F0JztcbmNvbnN0IERfRE9VQkxFID0gJ2Q6ZG91YmxlJztcbmNvbnN0IERfQk9PTEVBTiA9ICdkOmJvb2xlYW4nO1xuXG5ASW5qZWN0YWJsZSh7XG4gICAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFByb3BlcnR5R3JvdXBUcmFuc2xhdG9yU2VydmljZSB7XG5cbiAgICBzdGF0aWMgcmVhZG9ubHkgUkVDT0dOSVNFRF9FQ01fVFlQRVMgPSBbRF9URVhULCBEX01MVEVYVCwgRF9EQVRFLCBEX0RBVEVUSU1FLCBEX0lOVCwgRF9MT05HLCBEX0ZMT0FULCBEX0RPVUJMRSwgRF9CT09MRUFOXTtcblxuICAgIHZhbHVlU2VwYXJhdG9yOiBzdHJpbmc7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGxvZ1NlcnZpY2U6IExvZ1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBtdWx0aVZhbHVlUGlwZTogTXVsdGlWYWx1ZVBpcGUsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBkZWNpbWFsTnVtYmVyUGlwZTogRGVjaW1hbE51bWJlclBpcGUsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBhcHBDb25maWc6IEFwcENvbmZpZ1NlcnZpY2UpIHtcbiAgICAgICAgdGhpcy52YWx1ZVNlcGFyYXRvciA9IHRoaXMuYXBwQ29uZmlnLmdldDxzdHJpbmc+KCdjb250ZW50LW1ldGFkYXRhLm11bHRpLXZhbHVlLXBpcGUtc2VwYXJhdG9yJyk7XG4gICAgfVxuXG4gICAgcHVibGljIHRyYW5zbGF0ZVRvQ2FyZFZpZXdHcm91cHMocHJvcGVydHlHcm91cHM6IE9yZ2FuaXNlZFByb3BlcnR5R3JvdXBbXSwgcHJvcGVydHlWYWx1ZXMpOiBDYXJkVmlld0dyb3VwW10ge1xuICAgICAgICByZXR1cm4gcHJvcGVydHlHcm91cHMubWFwKChwcm9wZXJ0eUdyb3VwKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkUHJvcGVydHlHcm91cDogYW55ID0gT2JqZWN0LmFzc2lnbih7fSwgcHJvcGVydHlHcm91cCk7XG4gICAgICAgICAgICB0cmFuc2xhdGVkUHJvcGVydHlHcm91cC5wcm9wZXJ0aWVzID0gdGhpcy50cmFuc2xhdGVBcnJheShwcm9wZXJ0eUdyb3VwLnByb3BlcnRpZXMsIHByb3BlcnR5VmFsdWVzKTtcbiAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGVkUHJvcGVydHlHcm91cDtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGVBcnJheShwcm9wZXJ0aWVzOiBQcm9wZXJ0eVtdLCBwcm9wZXJ0eVZhbHVlczogYW55KTogQ2FyZFZpZXdJdGVtW10ge1xuICAgICAgICByZXR1cm4gcHJvcGVydGllcy5tYXAoKHByb3BlcnR5KSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy50cmFuc2xhdGUocHJvcGVydHksIHByb3BlcnR5VmFsdWVzKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGUocHJvcGVydHk6IFByb3BlcnR5LCBwcm9wZXJ0eVZhbHVlczogYW55KTogQ2FyZFZpZXdJdGVtIHtcbiAgICAgICAgbGV0IHByb3BlcnR5VmFsdWU7XG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlcyAmJiBwcm9wZXJ0eVZhbHVlc1twcm9wZXJ0eS5uYW1lXSkge1xuICAgICAgICAgICAgcHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5VmFsdWVzW3Byb3BlcnR5Lm5hbWVdO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jaGVja0VDTVR5cGVWYWxpZGl0eShwcm9wZXJ0eS5kYXRhVHlwZSk7XG5cbiAgICAgICAgY29uc3QgcHJlZml4ID0gJ3Byb3BlcnRpZXMuJztcblxuICAgICAgICBjb25zdCBwcm9wZXJ0eURlZmluaXRpb246IENhcmRWaWV3SXRlbVByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICBsYWJlbDogcHJvcGVydHkudGl0bGUgfHwgcHJvcGVydHkubmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wZXJ0eVZhbHVlLFxuICAgICAgICAgICAga2V5OiBgJHtwcmVmaXh9JHtwcm9wZXJ0eS5uYW1lfWAsXG4gICAgICAgICAgICBkZWZhdWx0OiBwcm9wZXJ0eS5kZWZhdWx0VmFsdWUsXG4gICAgICAgICAgICBlZGl0YWJsZTogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICBsZXQgY2FyZFZpZXdJdGVtUHJvcGVydHk7XG5cbiAgICAgICAgc3dpdGNoIChwcm9wZXJ0eS5kYXRhVHlwZSkge1xuXG4gICAgICAgICAgICBjYXNlIERfTUxURVhUOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICBtdWx0aWxpbmU6IHRydWVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9JTlQ6XG4gICAgICAgICAgICBjYXNlIERfTE9ORzpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0ludEl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfRkxPQVQ6XG4gICAgICAgICAgICBjYXNlIERfRE9VQkxFOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3RmxvYXRJdGVtTW9kZWwoT2JqZWN0LmFzc2lnbihwcm9wZXJ0eURlZmluaXRpb24sIHtcbiAgICAgICAgICAgICAgICAgICAgcGlwZXM6IFt7IHBpcGU6IHRoaXMuZGVjaW1hbE51bWJlclBpcGUgfV1cbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIGNhc2UgRF9EQVRFOlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3RGF0ZUl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfREFURVRJTUU6XG4gICAgICAgICAgICAgICAgY2FyZFZpZXdJdGVtUHJvcGVydHkgPSBuZXcgQ2FyZFZpZXdEYXRldGltZUl0ZW1Nb2RlbChwcm9wZXJ0eURlZmluaXRpb24pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICBjYXNlIERfQk9PTEVBTjpcbiAgICAgICAgICAgICAgICBjYXJkVmlld0l0ZW1Qcm9wZXJ0eSA9IG5ldyBDYXJkVmlld0Jvb2xJdGVtTW9kZWwocHJvcGVydHlEZWZpbml0aW9uKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgY2FzZSBEX1RFWFQ6XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNhcmRWaWV3SXRlbVByb3BlcnR5ID0gbmV3IENhcmRWaWV3VGV4dEl0ZW1Nb2RlbChPYmplY3QuYXNzaWduKHByb3BlcnR5RGVmaW5pdGlvbiwge1xuICAgICAgICAgICAgICAgICAgICBtdWx0aXZhbHVlZDogcHJvcGVydHkubXVsdGlWYWx1ZWQsXG4gICAgICAgICAgICAgICAgICAgIG11bHRpbGluZTogcHJvcGVydHkubXVsdGlWYWx1ZWQsXG4gICAgICAgICAgICAgICAgICAgIHBpcGVzOiBbeyBwaXBlOiB0aGlzLm11bHRpVmFsdWVQaXBlLCBwYXJhbXM6IFt0aGlzLnZhbHVlU2VwYXJhdG9yXX1dXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGNhcmRWaWV3SXRlbVByb3BlcnR5O1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tFQ01UeXBlVmFsaWRpdHkoZWNtUHJvcGVydHlUeXBlKSB7XG4gICAgICAgIGlmIChQcm9wZXJ0eUdyb3VwVHJhbnNsYXRvclNlcnZpY2UuUkVDT0dOSVNFRF9FQ01fVFlQRVMuaW5kZXhPZihlY21Qcm9wZXJ0eVR5cGUpID09PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5sb2dTZXJ2aWNlLmVycm9yKGBVbmtub3duIHR5cGUgZm9yIG1hcHBpbmc6ICR7ZWNtUHJvcGVydHlUeXBlfWApO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19