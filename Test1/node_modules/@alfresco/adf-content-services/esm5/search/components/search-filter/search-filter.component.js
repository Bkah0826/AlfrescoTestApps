/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
/*!
 * @license
 * Copyright 2019 Alfresco Software, Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Component, ViewEncapsulation } from '@angular/core';
import { SearchService, TranslationService } from '@alfresco/adf-core';
import { SearchQueryBuilderService } from '../../search-query-builder.service';
import { SearchFilterList } from './models/search-filter-list.model';
import { takeUntil } from 'rxjs/operators';
import { Subject } from 'rxjs';
var SearchFilterComponent = /** @class */ (function () {
    function SearchFilterComponent(queryBuilder, searchService, translationService) {
        var _this = this;
        this.queryBuilder = queryBuilder;
        this.searchService = searchService;
        this.translationService = translationService;
        this.DEFAULT_PAGE_SIZE = 5;
        /**
         * All facet field items to be displayed in the component. These are updated according to the response.
         *  When a new search is performed, the already existing items are updated with the new bucket count values and
         *  the newly received items are added to the responseFacets.
         */
        this.responseFacets = null;
        this.facetQueriesPageSize = this.DEFAULT_PAGE_SIZE;
        this.facetQueriesLabel = 'Facet Queries';
        this.facetExpanded = {
            'default': false
        };
        this.selectedBuckets = [];
        this.onDestroy$ = new Subject();
        if (queryBuilder.config && queryBuilder.config.facetQueries) {
            this.facetQueriesLabel = queryBuilder.config.facetQueries.label || 'Facet Queries';
            this.facetQueriesPageSize = queryBuilder.config.facetQueries.pageSize || this.DEFAULT_PAGE_SIZE;
            this.facetExpanded['query'] = queryBuilder.config.facetQueries.expanded;
        }
        if (queryBuilder.config && queryBuilder.config.facetFields) {
            this.facetExpanded['field'] = queryBuilder.config.facetFields.expanded;
        }
        if (queryBuilder.config && queryBuilder.config.facetIntervals) {
            this.facetExpanded['interval'] = queryBuilder.config.facetIntervals.expanded;
        }
        this.displayResetButton = this.queryBuilder.config && !!this.queryBuilder.config.resetButton;
        this.queryBuilder.updated
            .pipe(takeUntil(this.onDestroy$))
            .subscribe((/**
         * @return {?}
         */
        function () { return _this.queryBuilder.execute(); }));
    }
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        if (this.queryBuilder) {
            this.queryBuilder.executed
                .pipe(takeUntil(this.onDestroy$))
                .subscribe((/**
             * @param {?} resultSetPaging
             * @return {?}
             */
            function (resultSetPaging) {
                _this.onDataLoaded(resultSetPaging);
                _this.searchService.dataLoaded.next(resultSetPaging);
            }));
        }
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.onDestroy$.next(true);
        this.onDestroy$.complete();
    };
    /**
     * @private
     * @return {?}
     */
    SearchFilterComponent.prototype.updateSelectedBuckets = /**
     * @private
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (this.responseFacets) {
            this.selectedBuckets = [];
            var _loop_1 = function (field) {
                var _a;
                if (field.buckets) {
                    (_a = this_1.selectedBuckets).push.apply(_a, tslib_1.__spread(this_1.queryBuilder.getUserFacetBuckets(field.field)
                        .filter((/**
                     * @param {?} bucket
                     * @return {?}
                     */
                    function (bucket) { return bucket.checked; }))
                        .map((/**
                     * @param {?} bucket
                     * @return {?}
                     */
                    function (bucket) {
                        return { field: field, bucket: bucket };
                    }))));
                }
            };
            var this_1 = this;
            try {
                for (var _b = tslib_1.__values(this.responseFacets), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var field = _c.value;
                    _loop_1(field);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
        }
        else {
            this.selectedBuckets = [];
        }
    };
    /**
     * @param {?} event
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.onToggleBucket = /**
     * @param {?} event
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (event, field, bucket) {
        if (event && bucket) {
            if (event.checked) {
                this.selectFacetBucket(field, bucket);
            }
            else {
                this.unselectFacetBucket(field, bucket);
            }
        }
    };
    /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.selectFacetBucket = /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (field, bucket) {
        if (bucket) {
            bucket.checked = true;
            this.queryBuilder.addUserFacetBucket(field, bucket);
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.unselectFacetBucket = /**
     * @param {?} field
     * @param {?} bucket
     * @return {?}
     */
    function (field, bucket) {
        if (bucket) {
            bucket.checked = false;
            this.queryBuilder.removeUserFacetBucket(field, bucket);
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.canResetSelectedBuckets = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        if (field && field.buckets) {
            return field.buckets.items.some((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) { return bucket.checked; }));
        }
        return false;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.resetSelectedBuckets = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        var e_2, _a;
        if (field && field.buckets) {
            try {
                for (var _b = tslib_1.__values(field.buckets.items), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var bucket = _c.value;
                    bucket.checked = false;
                    this.queryBuilder.removeUserFacetBucket(field, bucket);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_2) throw e_2.error; }
            }
            this.updateSelectedBuckets();
            this.queryBuilder.update();
        }
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.resetAllSelectedBuckets = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.responseFacets.forEach((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            var e_3, _a;
            if (field && field.buckets) {
                try {
                    for (var _b = tslib_1.__values(field.buckets.items), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var bucket = _c.value;
                        bucket.checked = false;
                        _this.queryBuilder.removeUserFacetBucket(field, bucket);
                    }
                }
                catch (e_3_1) { e_3 = { error: e_3_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_3) throw e_3.error; }
                }
                _this.updateSelectedBuckets();
            }
        }));
        this.queryBuilder.update();
    };
    /**
     * @return {?}
     */
    SearchFilterComponent.prototype.resetAll = /**
     * @return {?}
     */
    function () {
        this.resetAllSelectedBuckets();
        this.responseFacets = null;
    };
    /**
     * @param {?} field
     * @return {?}
     */
    SearchFilterComponent.prototype.shouldExpand = /**
     * @param {?} field
     * @return {?}
     */
    function (field) {
        return this.facetExpanded[field.type] || this.facetExpanded['default'];
    };
    /**
     * @param {?} data
     * @return {?}
     */
    SearchFilterComponent.prototype.onDataLoaded = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        /** @type {?} */
        var context = data.list.context;
        if (context) {
            this.parseFacets(context);
        }
        else {
            this.responseFacets = null;
        }
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacets = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        this.parseFacetFields(context);
        this.parseFacetIntervals(context);
        this.parseFacetQueries(context);
    };
    /**
     * @private
     * @param {?} context
     * @param {?} configFacetFields
     * @param {?} itemType
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetItems = /**
     * @private
     * @param {?} context
     * @param {?} configFacetFields
     * @param {?} itemType
     * @return {?}
     */
    function (context, configFacetFields, itemType) {
        var _this = this;
        configFacetFields.forEach((/**
         * @param {?} field
         * @return {?}
         */
        function (field) {
            /** @type {?} */
            var responseField = _this.findFacet(context, itemType, field.label);
            /** @type {?} */
            var responseBuckets = _this.getResponseBuckets(responseField, field)
                .filter(_this.getFilterByMinCount(field.mincount));
            /** @type {?} */
            var alreadyExistingField = _this.findResponseFacet(itemType, field.label);
            if (alreadyExistingField) {
                /** @type {?} */
                var alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                _this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                /** @type {?} */
                var bucketList = new SearchFilterList(responseBuckets, field.pageSize);
                bucketList.filter = _this.getBucketFilterFunction(bucketList);
                if (!_this.responseFacets) {
                    _this.responseFacets = [];
                }
                _this.responseFacets.push((/** @type {?} */ (tslib_1.__assign({}, field, { type: responseField.type || itemType, label: field.label, pageSize: field.pageSize | _this.DEFAULT_PAGE_SIZE, currentPageSize: field.pageSize | _this.DEFAULT_PAGE_SIZE, buckets: bucketList }))));
            }
        }));
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetFields = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        /** @type {?} */
        var configFacetFields = this.queryBuilder.config.facetFields && this.queryBuilder.config.facetFields.fields || [];
        this.parseFacetItems(context, configFacetFields, 'field');
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetIntervals = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        /** @type {?} */
        var configFacetIntervals = this.queryBuilder.config.facetIntervals && this.queryBuilder.config.facetIntervals.intervals || [];
        this.parseFacetItems(context, configFacetIntervals, 'interval');
    };
    /**
     * @private
     * @param {?} context
     * @return {?}
     */
    SearchFilterComponent.prototype.parseFacetQueries = /**
     * @private
     * @param {?} context
     * @return {?}
     */
    function (context) {
        var _this = this;
        /** @type {?} */
        var configFacetQueries = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.queries || [];
        /** @type {?} */
        var configGroups = configFacetQueries.reduce((/**
         * @param {?} acc
         * @param {?} query
         * @return {?}
         */
        function (acc, query) {
            /** @type {?} */
            var group = _this.queryBuilder.getQueryGroup(query);
            if (acc[group]) {
                acc[group].push(query);
            }
            else {
                acc[group] = [query];
            }
            return acc;
        }), []);
        /** @type {?} */
        var mincount = this.queryBuilder.config.facetQueries && this.queryBuilder.config.facetQueries.mincount;
        /** @type {?} */
        var mincountFilter = this.getFilterByMinCount(mincount);
        Object.keys(configGroups).forEach((/**
         * @param {?} group
         * @return {?}
         */
        function (group) {
            /** @type {?} */
            var responseField = _this.findFacet(context, 'query', group);
            /** @type {?} */
            var responseBuckets = _this.getResponseQueryBuckets(responseField, configGroups[group])
                .filter(mincountFilter);
            /** @type {?} */
            var alreadyExistingField = _this.findResponseFacet('query', group);
            if (alreadyExistingField) {
                /** @type {?} */
                var alreadyExistingBuckets = alreadyExistingField.buckets && alreadyExistingField.buckets.items || [];
                _this.updateExistingBuckets(responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets);
            }
            else if (responseField) {
                /** @type {?} */
                var bucketList = new SearchFilterList(responseBuckets, _this.facetQueriesPageSize);
                bucketList.filter = _this.getBucketFilterFunction(bucketList);
                if (!_this.responseFacets) {
                    _this.responseFacets = [];
                }
                _this.responseFacets.push((/** @type {?} */ ({
                    field: group,
                    type: responseField.type || 'query',
                    label: group,
                    pageSize: _this.DEFAULT_PAGE_SIZE,
                    currentPageSize: _this.DEFAULT_PAGE_SIZE,
                    buckets: bucketList
                })));
            }
        }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} configField
     * @return {?}
     */
    SearchFilterComponent.prototype.getResponseBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} configField
     * @return {?}
     */
    function (responseField, configField) {
        var _this = this;
        return ((responseField && responseField.buckets) || []).map((/**
         * @param {?} respBucket
         * @return {?}
         */
        function (respBucket) {
            respBucket['count'] = _this.getCountValue(respBucket);
            respBucket.filterQuery = respBucket.filterQuery || _this.getCorrespondingFilterQuery(configField, respBucket.label);
            return (/** @type {?} */ (tslib_1.__assign({}, respBucket, { checked: false, display: respBucket.display, label: respBucket.label })));
        }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} configGroup
     * @return {?}
     */
    SearchFilterComponent.prototype.getResponseQueryBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} configGroup
     * @return {?}
     */
    function (responseField, configGroup) {
        var _this = this;
        return (configGroup || []).map((/**
         * @param {?} query
         * @return {?}
         */
        function (query) {
            /** @type {?} */
            var respBucket = ((responseField && responseField.buckets) || [])
                .find((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) { return bucket.label === query.label; }));
            respBucket['count'] = _this.getCountValue(respBucket);
            return (/** @type {?} */ (tslib_1.__assign({}, respBucket, { checked: false, display: respBucket.display, label: respBucket.label })));
        }));
    };
    /**
     * @private
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.getCountValue = /**
     * @private
     * @param {?} bucket
     * @return {?}
     */
    function (bucket) {
        return (!!bucket && !!bucket.metrics && bucket.metrics[0] && bucket.metrics[0].value && bucket.metrics[0].value.count)
            || 0;
    };
    /**
     * @param {?} bucket
     * @return {?}
     */
    SearchFilterComponent.prototype.getBucketCountDisplay = /**
     * @param {?} bucket
     * @return {?}
     */
    function (bucket) {
        return bucket.count === null ? '' : "(" + bucket.count + ")";
    };
    /**
     * @private
     * @param {?} mincountInput
     * @return {?}
     */
    SearchFilterComponent.prototype.getFilterByMinCount = /**
     * @private
     * @param {?} mincountInput
     * @return {?}
     */
    function (mincountInput) {
        return (/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            /** @type {?} */
            var mincount = mincountInput;
            if (mincount === undefined) {
                mincount = 1;
            }
            return bucket.count >= mincount;
        });
    };
    /**
     * @private
     * @param {?} configFacetItem
     * @param {?} bucketLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.getCorrespondingFilterQuery = /**
     * @private
     * @param {?} configFacetItem
     * @param {?} bucketLabel
     * @return {?}
     */
    function (configFacetItem, bucketLabel) {
        /** @type {?} */
        var filterQuery = null;
        if (configFacetItem.field && bucketLabel) {
            if (configFacetItem.sets) {
                /** @type {?} */
                var configSet = configFacetItem.sets.find((/**
                 * @param {?} set
                 * @return {?}
                 */
                function (set) { return bucketLabel === set.label; }));
                if (configSet) {
                    filterQuery = this.buildIntervalQuery(configFacetItem.field, configSet);
                }
            }
            else {
                filterQuery = configFacetItem.field + ":\"" + bucketLabel + "\"";
            }
        }
        return filterQuery;
    };
    /**
     * @private
     * @param {?} fieldName
     * @param {?} interval
     * @return {?}
     */
    SearchFilterComponent.prototype.buildIntervalQuery = /**
     * @private
     * @param {?} fieldName
     * @param {?} interval
     * @return {?}
     */
    function (fieldName, interval) {
        /** @type {?} */
        var start = interval.start;
        /** @type {?} */
        var end = interval.end;
        /** @type {?} */
        var startLimit = (interval.startInclusive === undefined || interval.startInclusive === true) ? '[' : '<';
        /** @type {?} */
        var endLimit = (interval.endInclusive === undefined || interval.endInclusive === true) ? ']' : '>';
        return fieldName + ":" + startLimit + "\"" + start + "\" TO \"" + end + "\"" + endLimit;
    };
    /**
     * @private
     * @param {?} context
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.findFacet = /**
     * @private
     * @param {?} context
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    function (context, itemType, fieldLabel) {
        return (context.facets || []).find((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response.type === itemType && response.label === fieldLabel; })) || {};
    };
    /**
     * @private
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    SearchFilterComponent.prototype.findResponseFacet = /**
     * @private
     * @param {?} itemType
     * @param {?} fieldLabel
     * @return {?}
     */
    function (itemType, fieldLabel) {
        return (this.responseFacets || []).find((/**
         * @param {?} response
         * @return {?}
         */
        function (response) { return response.type === itemType && response.label === fieldLabel; }));
    };
    /**
     * @private
     * @param {?} responseField
     * @param {?} responseBuckets
     * @param {?} alreadyExistingField
     * @param {?} alreadyExistingBuckets
     * @return {?}
     */
    SearchFilterComponent.prototype.updateExistingBuckets = /**
     * @private
     * @param {?} responseField
     * @param {?} responseBuckets
     * @param {?} alreadyExistingField
     * @param {?} alreadyExistingBuckets
     * @return {?}
     */
    function (responseField, responseBuckets, alreadyExistingField, alreadyExistingBuckets) {
        var _this = this;
        /** @type {?} */
        var bucketsToDelete = [];
        alreadyExistingBuckets
            .map((/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            /** @type {?} */
            var responseBucket = ((responseField && responseField.buckets) || []).find((/**
             * @param {?} respBucket
             * @return {?}
             */
            function (respBucket) { return respBucket.label === bucket.label; }));
            if (!responseBucket) {
                bucketsToDelete.push(bucket);
            }
            bucket.count = _this.getCountValue(responseBucket);
            return bucket;
        }));
        /** @type {?} */
        var hasSelection = this.selectedBuckets
            .find((/**
         * @param {?} selBuckets
         * @return {?}
         */
        function (selBuckets) { return alreadyExistingField.label === selBuckets.field.label && alreadyExistingField.type === selBuckets.field.type; }));
        if (!hasSelection && bucketsToDelete.length) {
            bucketsToDelete.forEach((/**
             * @param {?} bucket
             * @return {?}
             */
            function (bucket) {
                alreadyExistingField.buckets.deleteItem(bucket);
            }));
        }
        responseBuckets.forEach((/**
         * @param {?} respBucket
         * @return {?}
         */
        function (respBucket) {
            /** @type {?} */
            var existingBucket = alreadyExistingBuckets.find((/**
             * @param {?} oldBucket
             * @return {?}
             */
            function (oldBucket) { return oldBucket.label === respBucket.label; }));
            if (!existingBucket) {
                alreadyExistingField.buckets.addItem(respBucket);
            }
        }));
    };
    /**
     * @private
     * @param {?} bucketList
     * @return {?}
     */
    SearchFilterComponent.prototype.getBucketFilterFunction = /**
     * @private
     * @param {?} bucketList
     * @return {?}
     */
    function (bucketList) {
        var _this = this;
        return (/**
         * @param {?} bucket
         * @return {?}
         */
        function (bucket) {
            if (bucket && bucketList.filterText) {
                /** @type {?} */
                var pattern = (bucketList.filterText || '').toLowerCase();
                /** @type {?} */
                var label = (_this.translationService.instant(bucket.display) || _this.translationService.instant(bucket.label)).toLowerCase();
                return _this.queryBuilder.config.filterWithContains ? label.indexOf(pattern) !== -1 : label.startsWith(pattern);
            }
            return true;
        });
    };
    SearchFilterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'adf-search-filter',
                    template: "<mat-accordion multi=\"true\" displayMode=\"flat\">\n\n    <button *ngIf=\"displayResetButton && responseFacets\"\n            mat-button\n            color=\"primary\"\n            matTooltip=\"{{ 'SEARCH.FILTER.BUTTONS.RESET-ALL.TOOLTIP' | translate }}\"\n            matTooltipPosition=\"right\"\n            (click)=\"resetAll()\">\n        {{ 'SEARCH.FILTER.BUTTONS.RESET-ALL.LABEL' | translate }}\n    </button>\n    <mat-expansion-panel\n        *ngFor=\"let category of queryBuilder.categories\"\n        [attr.data-automation-id]=\"'expansion-panel-'+category.name\"\n        [(expanded)]=\"category.expanded\">\n        <mat-expansion-panel-header>\n            <mat-panel-title>\n                {{ category.name | translate }}\n            </mat-panel-title>\n        </mat-expansion-panel-header>\n        <adf-search-widget-container\n            [id]=\"category.id\"\n            [selector]=\"category.component.selector\"\n            [settings]=\"category.component.settings\">\n        </adf-search-widget-container>\n    </mat-expansion-panel>\n\n    <ng-container *ngIf=\"responseFacets\">\n        <mat-expansion-panel [attr.data-automation-id]=\"'expansion-panel-'+field.label\" *ngFor=\"let field of responseFacets\"\n                             [expanded]=\"shouldExpand(field)\">\n            <mat-expansion-panel-header>\n                <mat-panel-title>{{ field.label | translate }}</mat-panel-title>\n            </mat-expansion-panel-header>\n\n            <div class=\"adf-facet-result-filter\">\n                <mat-form-field>\n                    <input\n                        matInput\n                        placeholder=\"{{ 'SEARCH.FILTER.ACTIONS.FILTER-CATEGORY' | translate }}\"\n                        [attr.data-automation-id]=\"'facet-result-filter-'+field.label\"\n                        [(ngModel)]=\"field.buckets.filterText\">\n                    <button *ngIf=\"field.buckets.filterText\"\n                        mat-button matSuffix mat-icon-button\n                        (click)=\"field.buckets.filterText = ''\">\n                        <mat-icon>close</mat-icon>\n                    </button>\n                </mat-form-field>\n            </div>\n\n            <div class=\"adf-checklist\">\n                <mat-checkbox\n                    *ngFor=\"let bucket of field.buckets\"\n                    [checked]=\"bucket.checked\"\n                    [attr.data-automation-id]=\"'checkbox-'+field.label+'-'+(bucket.display || bucket.label)\"\n                    (change)=\"onToggleBucket($event, field, bucket)\">\n                    <div \n                        matTooltip=\"{{ bucket.display || bucket.label | translate }} {{ getBucketCountDisplay(bucket) }}\"\n                        matTooltipPosition=\"right\"\n                        class=\"adf-facet-label\">\n                        {{ bucket.display || bucket.label | translate }} {{ getBucketCountDisplay(bucket) }}\n                    </div>\n                </mat-checkbox>\n            </div>\n\n            <div class=\"adf-facet-buttons\" *ngIf=\"field.buckets.fitsPage\">\n                <button *ngIf=\"canResetSelectedBuckets(field)\"\n                    mat-button\n                    color=\"primary\"\n                    (click)=\"resetSelectedBuckets(field)\">\n                    {{ 'SEARCH.FILTER.ACTIONS.CLEAR-ALL' | translate }}\n                </button>\n            </div>\n\n            <div class=\"adf-facet-buttons\" *ngIf=\"!field.buckets.fitsPage\">\n                <button mat-icon-button\n                    *ngIf=\"canResetSelectedBuckets(field)\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.CLEAR-ALL' | translate }}\"\n                    (click)=\"resetSelectedBuckets(field)\">\n                    <mat-icon>clear</mat-icon>\n                </button>\n                <button mat-icon-button\n                    *ngIf=\"field.buckets.canShowLessItems\"\n                    (click)=\"field.buckets.showLessItems()\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.SHOW-LESS' | translate }}\">\n                    <mat-icon>keyboard_arrow_up</mat-icon>\n                </button>\n                <button mat-icon-button\n                    *ngIf=\"field.buckets.canShowMoreItems\"\n                    (click)=\"field.buckets.showMoreItems()\"\n                    title=\"{{ 'SEARCH.FILTER.ACTIONS.SHOW-MORE' | translate }}\">\n                    <mat-icon>keyboard_arrow_down</mat-icon>\n                </button>\n            </div>\n        </mat-expansion-panel>\n    </ng-container>\n</mat-accordion>\n",
                    encapsulation: ViewEncapsulation.None,
                    host: { class: 'adf-search-filter' },
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    SearchFilterComponent.ctorParameters = function () { return [
        { type: SearchQueryBuilderService },
        { type: SearchService },
        { type: TranslationService }
    ]; };
    return SearchFilterComponent;
}());
export { SearchFilterComponent };
if (false) {
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.DEFAULT_PAGE_SIZE;
    /**
     * All facet field items to be displayed in the component. These are updated according to the response.
     *  When a new search is performed, the already existing items are updated with the new bucket count values and
     *  the newly received items are added to the responseFacets.
     * @type {?}
     */
    SearchFilterComponent.prototype.responseFacets;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.facetQueriesPageSize;
    /** @type {?} */
    SearchFilterComponent.prototype.facetQueriesLabel;
    /** @type {?} */
    SearchFilterComponent.prototype.facetExpanded;
    /** @type {?} */
    SearchFilterComponent.prototype.displayResetButton;
    /** @type {?} */
    SearchFilterComponent.prototype.selectedBuckets;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.onDestroy$;
    /** @type {?} */
    SearchFilterComponent.prototype.queryBuilder;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.searchService;
    /**
     * @type {?}
     * @private
     */
    SearchFilterComponent.prototype.translationService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VhcmNoLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AYWxmcmVzY28vYWRmLWNvbnRlbnQtc2VydmljZXMvIiwic291cmNlcyI6WyJzZWFyY2gvY29tcG9uZW50cy9zZWFyY2gtZmlsdGVyL3NlYXJjaC1maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQSxPQUFPLEVBQUUsU0FBUyxFQUFFLGlCQUFpQixFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUVoRixPQUFPLEVBQUUsYUFBYSxFQUFFLGtCQUFrQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDdkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFHL0UsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sbUNBQW1DLENBQUM7QUFDckUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFL0I7SUEyQkksK0JBQW1CLFlBQXVDLEVBQ3RDLGFBQTRCLEVBQzVCLGtCQUFzQztRQUYxRCxpQkFtQkM7UUFuQmtCLGlCQUFZLEdBQVosWUFBWSxDQUEyQjtRQUN0QyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1Qix1QkFBa0IsR0FBbEIsa0JBQWtCLENBQW9CO1FBcEJsRCxzQkFBaUIsR0FBRyxDQUFDLENBQUM7Ozs7OztRQU05QixtQkFBYyxHQUFpQixJQUFJLENBQUM7UUFFNUIseUJBQW9CLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO1FBQ3RELHNCQUFpQixHQUFXLGVBQWUsQ0FBQztRQUM1QyxrQkFBYSxHQUFHO1lBQ1osU0FBUyxFQUFFLEtBQUs7U0FDbkIsQ0FBQztRQUVGLG9CQUFlLEdBQTJELEVBQUUsQ0FBQztRQUVyRSxlQUFVLEdBQUcsSUFBSSxPQUFPLEVBQVcsQ0FBQztRQUt4QyxJ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Z2h0IDIwMTkgQWxmcmVzY28gU29mdHdhcmUsIEx0ZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ29tcG9uZW50LCBWaWV3RW5jYXBzdWxhdGlvbiwgT25Jbml0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1hdENoZWNrYm94Q2hhbmdlIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwnO1xuaW1wb3J0IHsgU2VhcmNoU2VydmljZSwgVHJhbnNsYXRpb25TZXJ2aWNlIH0gZnJvbSAnQGFsZnJlc2NvL2FkZi1jb3JlJztcbmltcG9ydCB7IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZWFyY2gtcXVlcnktYnVpbGRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGRCdWNrZXQgfSBmcm9tICcuLi8uLi9mYWNldC1maWVsZC1idWNrZXQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEZhY2V0RmllbGQgfSBmcm9tICcuLi8uLi9mYWNldC1maWVsZC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgU2VhcmNoRmlsdGVyTGlzdCB9IGZyb20gJy4vbW9kZWxzL3NlYXJjaC1maWx0ZXItbGlzdC5tb2RlbCc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBHZW5lcmljQnVja2V0LCBHZW5lcmljRmFjZXRSZXNwb25zZSwgUmVzdWx0U2V0Q29udGV4dCB9IGZyb20gJ0BhbGZyZXNjby9qcy1hcGknO1xuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ2FkZi1zZWFyY2gtZmlsdGVyJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2VhcmNoLWZpbHRlci5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJy4vc2VhcmNoLWZpbHRlci5jb21wb25lbnQuc2NzcyddLFxuICAgIGVuY2Fwc3VsYXRpb246IFZpZXdFbmNhcHN1bGF0aW9uLk5vbmUsXG4gICAgaG9zdDogeyBjbGFzczogJ2FkZi1zZWFyY2gtZmlsdGVyJyB9XG59KVxuZXhwb3J0IGNsYXNzIFNlYXJjaEZpbHRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblxuICAgIHByaXZhdGUgREVGQVVMVF9QQUdFX1NJWkUgPSA1O1xuXG4gICAgLyoqIEFsbCBmYWNldCBmaWVsZCBpdGVtcyB0byBiZSBkaXNwbGF5ZWQgaW4gdGhlIGNvbXBvbmVudC4gVGhlc2UgYXJlIHVwZGF0ZWQgYWNjb3JkaW5nIHRvIHRoZSByZXNwb25zZS5cbiAgICAgKiAgV2hlbiBhIG5ldyBzZWFyY2ggaXMgcGVyZm9ybWVkLCB0aGUgYWxyZWFkeSBleGlzdGluZyBpdGVtcyBhcmUgdXBkYXRlZCB3aXRoIHRoZSBuZXcgYnVja2V0IGNvdW50IHZhbHVlcyBhbmRcbiAgICAgKiAgdGhlIG5ld2x5IHJlY2VpdmVkIGl0ZW1zIGFyZSBhZGRlZCB0byB0aGUgcmVzcG9uc2VGYWNldHMuXG4gICAgICovXG4gICAgcmVzcG9uc2VGYWNldHM6IEZhY2V0RmllbGRbXSA9IG51bGw7XG5cbiAgICBwcml2YXRlIGZhY2V0UXVlcmllc1BhZ2VTaXplID0gdGhpcy5ERUZBVUxUX1BBR0VfU0laRTtcbiAgICBmYWNldFF1ZXJpZXNMYWJlbDogc3RyaW5nID0gJ0ZhY2V0IFF1ZXJpZXMnO1xuICAgIGZhY2V0RXhwYW5kZWQgPSB7XG4gICAgICAgICdkZWZhdWx0JzogZmFsc2VcbiAgICB9O1xuICAgIGRpc3BsYXlSZXNldEJ1dHRvbjogYm9vbGVhbjtcbiAgICBzZWxlY3RlZEJ1Y2tldHM6IEFycmF5PHsgZmllbGQ6IEZhY2V0RmllbGQsIGJ1Y2tldDogRmFjZXRGaWVsZEJ1Y2tldCB9PiA9IFtdO1xuXG4gICAgcHJpdmF0ZSBvbkRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBxdWVyeUJ1aWxkZXI6IFNlYXJjaFF1ZXJ5QnVpbGRlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSBzZWFyY2hTZXJ2aWNlOiBTZWFyY2hTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgdHJhbnNsYXRpb25TZXJ2aWNlOiBUcmFuc2xhdGlvblNlcnZpY2UpIHtcbiAgICAgICAgaWYgKHF1ZXJ5QnVpbGRlci5jb25maWcgJiYgcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMpIHtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRRdWVyaWVzTGFiZWwgPSBxdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcy5sYWJlbCB8fCAnRmFjZXQgUXVlcmllcyc7XG4gICAgICAgICAgICB0aGlzLmZhY2V0UXVlcmllc1BhZ2VTaXplID0gcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldFF1ZXJpZXMucGFnZVNpemUgfHwgdGhpcy5ERUZBVUxUX1BBR0VfU0laRTtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRFeHBhbmRlZFsncXVlcnknXSA9IHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRRdWVyaWVzLmV4cGFuZGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeUJ1aWxkZXIuY29uZmlnICYmIHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRGaWVsZHMpIHtcbiAgICAgICAgICAgIHRoaXMuZmFjZXRFeHBhbmRlZFsnZmllbGQnXSA9IHF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRGaWVsZHMuZXhwYW5kZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5QnVpbGRlci5jb25maWcgJiYgcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscykge1xuICAgICAgICAgICAgdGhpcy5mYWNldEV4cGFuZGVkWydpbnRlcnZhbCddID0gcXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscy5leHBhbmRlZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRpc3BsYXlSZXNldEJ1dHRvbiA9IHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZyAmJiAhIXRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5yZXNldEJ1dHRvbjtcblxuICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGVkXG4gICAgICAgICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5vbkRlc3Ryb3kkKSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5xdWVyeUJ1aWxkZXIuZXhlY3V0ZSgpKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMucXVlcnlCdWlsZGVyKSB7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5leGVjdXRlZFxuICAgICAgICAgICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLm9uRGVzdHJveSQpKVxuICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUocmVzdWx0U2V0UGFnaW5nID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFMb2FkZWQocmVzdWx0U2V0UGFnaW5nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZWFyY2hTZXJ2aWNlLmRhdGFMb2FkZWQubmV4dChyZXN1bHRTZXRQYWdpbmcpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMub25EZXN0cm95JC5uZXh0KHRydWUpO1xuICAgICAgICB0aGlzLm9uRGVzdHJveSQuY29tcGxldGUoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHVwZGF0ZVNlbGVjdGVkQnVja2V0cygpIHtcbiAgICAgICAgaWYgKHRoaXMucmVzcG9uc2VGYWNldHMpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRCdWNrZXRzID0gW107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHRoaXMucmVzcG9uc2VGYWNldHMpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmllbGQuYnVja2V0cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkQnVja2V0cy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICAgICAgLi4udGhpcy5xdWVyeUJ1aWxkZXIuZ2V0VXNlckZhY2V0QnVja2V0cyhmaWVsZC5maWVsZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKChidWNrZXQpID0+IGJ1Y2tldC5jaGVja2VkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGJ1Y2tldCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyBmaWVsZCwgYnVja2V0IH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGVkQnVja2V0cyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25Ub2dnbGVCdWNrZXQoZXZlbnQ6IE1hdENoZWNrYm94Q2hhbmdlLCBmaWVsZDogRmFjZXRGaWVsZCwgYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KSB7XG4gICAgICAgIGlmIChldmVudCAmJiBidWNrZXQpIHtcbiAgICAgICAgICAgIGlmIChldmVudC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RGYWNldEJ1Y2tldChmaWVsZCwgYnVja2V0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy51bnNlbGVjdEZhY2V0QnVja2V0KGZpZWxkLCBidWNrZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2VsZWN0RmFjZXRCdWNrZXQoZmllbGQ6IEZhY2V0RmllbGQsIGJ1Y2tldDogRmFjZXRGaWVsZEJ1Y2tldCkge1xuICAgICAgICBpZiAoYnVja2V0KSB7XG4gICAgICAgICAgICBidWNrZXQuY2hlY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci5hZGRVc2VyRmFjZXRCdWNrZXQoZmllbGQsIGJ1Y2tldCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQnVja2V0cygpO1xuICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1bnNlbGVjdEZhY2V0QnVja2V0KGZpZWxkOiBGYWNldEZpZWxkLCBidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpIHtcbiAgICAgICAgaWYgKGJ1Y2tldCkge1xuICAgICAgICAgICAgYnVja2V0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLnJlbW92ZVVzZXJGYWNldEJ1Y2tldChmaWVsZCwgYnVja2V0KTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRCdWNrZXRzKCk7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNhblJlc2V0U2VsZWN0ZWRCdWNrZXRzKGZpZWxkOiBGYWNldEZpZWxkKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChmaWVsZCAmJiBmaWVsZC5idWNrZXRzKSB7XG4gICAgICAgICAgICByZXR1cm4gZmllbGQuYnVja2V0cy5pdGVtcy5zb21lKChidWNrZXQpID0+IGJ1Y2tldC5jaGVja2VkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmVzZXRTZWxlY3RlZEJ1Y2tldHMoZmllbGQ6IEZhY2V0RmllbGQpIHtcbiAgICAgICAgaWYgKGZpZWxkICYmIGZpZWxkLmJ1Y2tldHMpIHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYnVja2V0IG9mIGZpZWxkLmJ1Y2tldHMuaXRlbXMpIHtcbiAgICAgICAgICAgICAgICBidWNrZXQuY2hlY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMucXVlcnlCdWlsZGVyLnJlbW92ZVVzZXJGYWNldEJ1Y2tldChmaWVsZCwgYnVja2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRCdWNrZXRzKCk7XG4gICAgICAgICAgICB0aGlzLnF1ZXJ5QnVpbGRlci51cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlc2V0QWxsU2VsZWN0ZWRCdWNrZXRzKCkge1xuICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmllbGQgJiYgZmllbGQuYnVja2V0cykge1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgYnVja2V0IG9mIGZpZWxkLmJ1Y2tldHMuaXRlbXMpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVja2V0LmNoZWNrZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIucmVtb3ZlVXNlckZhY2V0QnVja2V0KGZpZWxkLCBidWNrZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkQnVja2V0cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5xdWVyeUJ1aWxkZXIudXBkYXRlKCk7XG4gICAgfVxuXG4gICAgcmVzZXRBbGwoKSB7XG4gICAgICAgIHRoaXMucmVzZXRBbGxTZWxlY3RlZEJ1Y2tldHMoKTtcbiAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cyA9IG51bGw7XG4gICAgfVxuXG4gICAgc2hvdWxkRXhwYW5kKGZpZWxkOiBGYWNldEZpZWxkKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmZhY2V0RXhwYW5kZWRbZmllbGQudHlwZV0gfHwgdGhpcy5mYWNldEV4cGFuZGVkWydkZWZhdWx0J107XG4gICAgfVxuXG4gICAgb25EYXRhTG9hZGVkKGRhdGE6IGFueSkge1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gZGF0YS5saXN0LmNvbnRleHQ7XG5cbiAgICAgICAgaWYgKGNvbnRleHQpIHtcbiAgICAgICAgICAgIHRoaXMucGFyc2VGYWNldHMoY29udGV4dCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJlc3BvbnNlRmFjZXRzID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgcGFyc2VGYWNldHMoY29udGV4dDogUmVzdWx0U2V0Q29udGV4dCkge1xuICAgICAgICB0aGlzLnBhcnNlRmFjZXRGaWVsZHMoY29udGV4dCk7XG4gICAgICAgIHRoaXMucGFyc2VGYWNldEludGVydmFscyhjb250ZXh0KTtcbiAgICAgICAgdGhpcy5wYXJzZUZhY2V0UXVlcmllcyhjb250ZXh0KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRJdGVtcyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0LCBjb25maWdGYWNldEZpZWxkczogRmFjZXRGaWVsZFtdLCBpdGVtVHlwZTogc3RyaW5nKSB7XG4gICAgICAgIGNvbmZpZ0ZhY2V0RmllbGRzLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXNwb25zZUZpZWxkID0gdGhpcy5maW5kRmFjZXQoY29udGV4dCwgaXRlbVR5cGUsIGZpZWxkLmxhYmVsKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQnVja2V0cyA9IHRoaXMuZ2V0UmVzcG9uc2VCdWNrZXRzKHJlc3BvbnNlRmllbGQsIGZpZWxkKVxuICAgICAgICAgICAgICAgIC5maWx0ZXIodGhpcy5nZXRGaWx0ZXJCeU1pbkNvdW50KGZpZWxkLm1pbmNvdW50KSk7XG4gICAgICAgICAgICBjb25zdCBhbHJlYWR5RXhpc3RpbmdGaWVsZCA9IHRoaXMuZmluZFJlc3BvbnNlRmFjZXQoaXRlbVR5cGUsIGZpZWxkLmxhYmVsKTtcblxuICAgICAgICAgICAgaWYgKGFscmVhZHlFeGlzdGluZ0ZpZWxkKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYWxyZWFkeUV4aXN0aW5nQnVja2V0cyA9IGFscmVhZHlFeGlzdGluZ0ZpZWxkLmJ1Y2tldHMgJiYgYWxyZWFkeUV4aXN0aW5nRmllbGQuYnVja2V0cy5pdGVtcyB8fCBbXTtcblxuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRXhpc3RpbmdCdWNrZXRzKHJlc3BvbnNlRmllbGQsIHJlc3BvbnNlQnVja2V0cywgYWxyZWFkeUV4aXN0aW5nRmllbGQsIGFscmVhZHlFeGlzdGluZ0J1Y2tldHMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZUZpZWxkKSB7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBidWNrZXRMaXN0ID0gbmV3IFNlYXJjaEZpbHRlckxpc3Q8RmFjZXRGaWVsZEJ1Y2tldD4ocmVzcG9uc2VCdWNrZXRzLCBmaWVsZC5wYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgYnVja2V0TGlzdC5maWx0ZXIgPSB0aGlzLmdldEJ1Y2tldEZpbHRlckZ1bmN0aW9uKGJ1Y2tldExpc3QpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cy5wdXNoKDxGYWNldEZpZWxkPiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLmZpZWxkLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiByZXNwb25zZUZpZWxkLnR5cGUgfHwgaXRlbVR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBmaWVsZC5sYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IGZpZWxkLnBhZ2VTaXplIHwgdGhpcy5ERUZBVUxUX1BBR0VfU0laRSxcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBhZ2VTaXplOiBmaWVsZC5wYWdlU2l6ZSB8IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgIGJ1Y2tldHM6IGJ1Y2tldExpc3RcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBwYXJzZUZhY2V0RmllbGRzKGNvbnRleHQ6IFJlc3VsdFNldENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY29uZmlnRmFjZXRGaWVsZHMgPSB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRGaWVsZHMgJiYgdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0RmllbGRzLmZpZWxkcyB8fCBbXTtcbiAgICAgICAgdGhpcy5wYXJzZUZhY2V0SXRlbXMoY29udGV4dCwgY29uZmlnRmFjZXRGaWVsZHMsICdmaWVsZCcpO1xuICAgIH1cblxuICAgIHByaXZhdGUgcGFyc2VGYWNldEludGVydmFscyhjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0KSB7XG4gICAgICAgIGNvbnN0IGNvbmZpZ0ZhY2V0SW50ZXJ2YWxzID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0SW50ZXJ2YWxzICYmIHRoaXMucXVlcnlCdWlsZGVyLmNvbmZpZy5mYWNldEludGVydmFscy5pbnRlcnZhbHMgfHwgW107XG4gICAgICAgIHRoaXMucGFyc2VGYWNldEl0ZW1zKGNvbnRleHQsIGNvbmZpZ0ZhY2V0SW50ZXJ2YWxzLCAnaW50ZXJ2YWwnKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHBhcnNlRmFjZXRRdWVyaWVzKGNvbnRleHQ6IFJlc3VsdFNldENvbnRleHQpIHtcbiAgICAgICAgY29uc3QgY29uZmlnRmFjZXRRdWVyaWVzID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcyAmJiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRRdWVyaWVzLnF1ZXJpZXMgfHwgW107XG4gICAgICAgIGNvbnN0IGNvbmZpZ0dyb3VwcyA9IGNvbmZpZ0ZhY2V0UXVlcmllcy5yZWR1Y2UoKGFjYywgcXVlcnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGdyb3VwID0gdGhpcy5xdWVyeUJ1aWxkZXIuZ2V0UXVlcnlHcm91cChxdWVyeSk7XG4gICAgICAgICAgICBpZiAoYWNjW2dyb3VwXSkge1xuICAgICAgICAgICAgICAgIGFjY1tncm91cF0ucHVzaChxdWVyeSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGFjY1tncm91cF0gPSBbcXVlcnldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgICAgfSwgW10pO1xuXG4gICAgICAgIGNvbnN0IG1pbmNvdW50ID0gdGhpcy5xdWVyeUJ1aWxkZXIuY29uZmlnLmZhY2V0UXVlcmllcyAmJiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmFjZXRRdWVyaWVzLm1pbmNvdW50O1xuICAgICAgICBjb25zdCBtaW5jb3VudEZpbHRlciA9IHRoaXMuZ2V0RmlsdGVyQnlNaW5Db3VudChtaW5jb3VudCk7XG5cbiAgICAgICAgT2JqZWN0LmtleXMoY29uZmlnR3JvdXBzKS5mb3JFYWNoKChncm91cCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VGaWVsZCA9IHRoaXMuZmluZEZhY2V0KGNvbnRleHQsICdxdWVyeScsIGdyb3VwKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlQnVja2V0cyA9IHRoaXMuZ2V0UmVzcG9uc2VRdWVyeUJ1Y2tldHMocmVzcG9uc2VGaWVsZCwgY29uZmlnR3JvdXBzW2dyb3VwXSlcbiAgICAgICAgICAgICAgICAuZmlsdGVyKG1pbmNvdW50RmlsdGVyKTtcbiAgICAgICAgICAgIGNvbnN0IGFscmVhZHlFeGlzdGluZ0ZpZWxkID0gdGhpcy5maW5kUmVzcG9uc2VGYWNldCgncXVlcnknLCBncm91cCk7XG5cbiAgICAgICAgICAgIGlmIChhbHJlYWR5RXhpc3RpbmdGaWVsZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGFscmVhZHlFeGlzdGluZ0J1Y2tldHMgPSBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzICYmIGFscmVhZHlFeGlzdGluZ0ZpZWxkLmJ1Y2tldHMuaXRlbXMgfHwgW107XG5cbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUV4aXN0aW5nQnVja2V0cyhyZXNwb25zZUZpZWxkLCByZXNwb25zZUJ1Y2tldHMsIGFscmVhZHlFeGlzdGluZ0ZpZWxkLCBhbHJlYWR5RXhpc3RpbmdCdWNrZXRzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2VGaWVsZCkge1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYnVja2V0TGlzdCA9IG5ldyBTZWFyY2hGaWx0ZXJMaXN0PEZhY2V0RmllbGRCdWNrZXQ+KHJlc3BvbnNlQnVja2V0cywgdGhpcy5mYWNldFF1ZXJpZXNQYWdlU2l6ZSk7XG4gICAgICAgICAgICAgICAgYnVja2V0TGlzdC5maWx0ZXIgPSB0aGlzLmdldEJ1Y2tldEZpbHRlckZ1bmN0aW9uKGJ1Y2tldExpc3QpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLnJlc3BvbnNlRmFjZXRzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VGYWNldHMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNwb25zZUZhY2V0cy5wdXNoKDxGYWNldEZpZWxkPiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBncm91cCxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzcG9uc2VGaWVsZC50eXBlIHx8ICdxdWVyeScsXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBncm91cCxcbiAgICAgICAgICAgICAgICAgICAgcGFnZVNpemU6IHRoaXMuREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRQYWdlU2l6ZTogdGhpcy5ERUZBVUxUX1BBR0VfU0laRSxcbiAgICAgICAgICAgICAgICAgICAgYnVja2V0czogYnVja2V0TGlzdFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0UmVzcG9uc2VCdWNrZXRzKHJlc3BvbnNlRmllbGQ6IEdlbmVyaWNGYWNldFJlc3BvbnNlLCBjb25maWdGaWVsZDogRmFjZXRGaWVsZCk6IEZhY2V0RmllbGRCdWNrZXRbXSB7XG4gICAgICAgIHJldHVybiAoKHJlc3BvbnNlRmllbGQgJiYgcmVzcG9uc2VGaWVsZC5idWNrZXRzKSB8fCBbXSkubWFwKChyZXNwQnVja2V0KSA9PiB7XG5cbiAgICAgICAgICAgIHJlc3BCdWNrZXRbJ2NvdW50J10gPSB0aGlzLmdldENvdW50VmFsdWUocmVzcEJ1Y2tldCk7XG4gICAgICAgICAgICByZXNwQnVja2V0LmZpbHRlclF1ZXJ5ID0gcmVzcEJ1Y2tldC5maWx0ZXJRdWVyeSB8fCB0aGlzLmdldENvcnJlc3BvbmRpbmdGaWx0ZXJRdWVyeShjb25maWdGaWVsZCwgcmVzcEJ1Y2tldC5sYWJlbCk7XG4gICAgICAgICAgICByZXR1cm4gPEZhY2V0RmllbGRCdWNrZXQ+IHtcbiAgICAgICAgICAgICAgICAuLi5yZXNwQnVja2V0LFxuICAgICAgICAgICAgICAgIGNoZWNrZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRpc3BsYXk6IHJlc3BCdWNrZXQuZGlzcGxheSxcbiAgICAgICAgICAgICAgICBsYWJlbDogcmVzcEJ1Y2tldC5sYWJlbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRSZXNwb25zZVF1ZXJ5QnVja2V0cyhyZXNwb25zZUZpZWxkOiBHZW5lcmljRmFjZXRSZXNwb25zZSwgY29uZmlnR3JvdXA6IGFueSk6IEZhY2V0RmllbGRCdWNrZXRbXSB7XG4gICAgICAgIHJldHVybiAoY29uZmlnR3JvdXAgfHwgW10pLm1hcCgocXVlcnkpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BCdWNrZXQgPSAoKHJlc3BvbnNlRmllbGQgJiYgcmVzcG9uc2VGaWVsZC5idWNrZXRzKSB8fCBbXSlcbiAgICAgICAgICAgICAgICAuZmluZCgoYnVja2V0KSA9PiBidWNrZXQubGFiZWwgPT09IHF1ZXJ5LmxhYmVsKTtcblxuICAgICAgICAgICAgcmVzcEJ1Y2tldFsnY291bnQnXSA9IHRoaXMuZ2V0Q291bnRWYWx1ZShyZXNwQnVja2V0KTtcbiAgICAgICAgICAgIHJldHVybiA8RmFjZXRGaWVsZEJ1Y2tldD4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3BCdWNrZXQsXG4gICAgICAgICAgICAgICAgY2hlY2tlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgZGlzcGxheTogcmVzcEJ1Y2tldC5kaXNwbGF5LFxuICAgICAgICAgICAgICAgIGxhYmVsOiByZXNwQnVja2V0LmxhYmVsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldENvdW50VmFsdWUoYnVja2V0OiBHZW5lcmljQnVja2V0KTogbnVtYmVyIHtcbiAgICAgICAgcmV0dXJuICghIWJ1Y2tldCAmJiAhIWJ1Y2tldC5tZXRyaWNzICYmIGJ1Y2tldC5tZXRyaWNzWzBdICYmIGJ1Y2tldC5tZXRyaWNzWzBdLnZhbHVlICYmIGJ1Y2tldC5tZXRyaWNzWzBdLnZhbHVlLmNvdW50KVxuICAgICAgICAgICAgfHwgMDtcbiAgICB9XG5cbiAgICBnZXRCdWNrZXRDb3VudERpc3BsYXkoYnVja2V0OiBGYWNldEZpZWxkQnVja2V0KTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGJ1Y2tldC5jb3VudCA9PT0gbnVsbCA/ICcnIDogYCgke2J1Y2tldC5jb3VudH0pYDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdldEZpbHRlckJ5TWluQ291bnQobWluY291bnRJbnB1dDogbnVtYmVyKSB7XG4gICAgICAgIHJldHVybiAoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICBsZXQgbWluY291bnQgPSBtaW5jb3VudElucHV0O1xuICAgICAgICAgICAgaWYgKG1pbmNvdW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBtaW5jb3VudCA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gYnVja2V0LmNvdW50ID49IG1pbmNvdW50O1xuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0Q29ycmVzcG9uZGluZ0ZpbHRlclF1ZXJ5IChjb25maWdGYWNldEl0ZW06IEZhY2V0RmllbGQsIGJ1Y2tldExhYmVsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICBsZXQgZmlsdGVyUXVlcnkgPSBudWxsO1xuXG4gICAgICAgIGlmIChjb25maWdGYWNldEl0ZW0uZmllbGQgJiYgYnVja2V0TGFiZWwpIHtcblxuICAgICAgICAgICAgaWYgKGNvbmZpZ0ZhY2V0SXRlbS5zZXRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29uZmlnU2V0ID0gY29uZmlnRmFjZXRJdGVtLnNldHMuZmluZCgoc2V0KSA9PiBidWNrZXRMYWJlbCA9PT0gc2V0LmxhYmVsKTtcblxuICAgICAgICAgICAgICAgIGlmIChjb25maWdTZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyUXVlcnkgPSB0aGlzLmJ1aWxkSW50ZXJ2YWxRdWVyeShjb25maWdGYWNldEl0ZW0uZmllbGQsIGNvbmZpZ1NldCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGZpbHRlclF1ZXJ5ID0gYCR7Y29uZmlnRmFjZXRJdGVtLmZpZWxkfTpcIiR7YnVja2V0TGFiZWx9XCJgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZpbHRlclF1ZXJ5O1xuICAgIH1cblxuICAgIHByaXZhdGUgYnVpbGRJbnRlcnZhbFF1ZXJ5KGZpZWxkTmFtZTogc3RyaW5nLCBpbnRlcnZhbDogYW55KTogc3RyaW5nIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBpbnRlcnZhbC5zdGFydDtcbiAgICAgICAgY29uc3QgZW5kID0gaW50ZXJ2YWwuZW5kO1xuICAgICAgICBjb25zdCBzdGFydExpbWl0ID0gKGludGVydmFsLnN0YXJ0SW5jbHVzaXZlID09PSB1bmRlZmluZWQgfHwgaW50ZXJ2YWwuc3RhcnRJbmNsdXNpdmUgPT09IHRydWUpID8gJ1snIDogJzwnO1xuICAgICAgICBjb25zdCBlbmRMaW1pdCA9IChpbnRlcnZhbC5lbmRJbmNsdXNpdmUgPT09IHVuZGVmaW5lZCB8fCBpbnRlcnZhbC5lbmRJbmNsdXNpdmUgPT09IHRydWUpID8gJ10nIDogJz4nO1xuXG4gICAgICAgIHJldHVybiBgJHtmaWVsZE5hbWV9OiR7c3RhcnRMaW1pdH1cIiR7c3RhcnR9XCIgVE8gXCIke2VuZH1cIiR7ZW5kTGltaXR9YDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbmRGYWNldChjb250ZXh0OiBSZXN1bHRTZXRDb250ZXh0LCBpdGVtVHlwZTogc3RyaW5nLCBmaWVsZExhYmVsOiBzdHJpbmcpOiBHZW5lcmljRmFjZXRSZXNwb25zZSB7XG4gICAgICAgIHJldHVybiAoY29udGV4dC5mYWNldHMgfHwgW10pLmZpbmQoKHJlc3BvbnNlKSA9PiByZXNwb25zZS50eXBlID09PSBpdGVtVHlwZSAmJiByZXNwb25zZS5sYWJlbCA9PT0gZmllbGRMYWJlbCkgfHwge307XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaW5kUmVzcG9uc2VGYWNldChpdGVtVHlwZTogc3RyaW5nLCBmaWVsZExhYmVsOiBzdHJpbmcpOiBGYWNldEZpZWxkIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnJlc3BvbnNlRmFjZXRzIHx8IFtdKS5maW5kKChyZXNwb25zZSkgPT4gcmVzcG9uc2UudHlwZSA9PT0gaXRlbVR5cGUgJiYgcmVzcG9uc2UubGFiZWwgPT09IGZpZWxkTGFiZWwpO1xuICAgIH1cblxuICAgIHByaXZhdGUgdXBkYXRlRXhpc3RpbmdCdWNrZXRzKHJlc3BvbnNlRmllbGQsIHJlc3BvbnNlQnVja2V0cywgYWxyZWFkeUV4aXN0aW5nRmllbGQsIGFscmVhZHlFeGlzdGluZ0J1Y2tldHMpIHtcbiAgICAgICAgY29uc3QgYnVja2V0c1RvRGVsZXRlID0gW107XG5cbiAgICAgICAgYWxyZWFkeUV4aXN0aW5nQnVja2V0c1xuICAgICAgICAgICAgLm1hcCgoYnVja2V0KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2VCdWNrZXQgPSAoKHJlc3BvbnNlRmllbGQgJiYgcmVzcG9uc2VGaWVsZC5idWNrZXRzKSB8fCBbXSkuZmluZCgocmVzcEJ1Y2tldCkgPT4gcmVzcEJ1Y2tldC5sYWJlbCA9PT0gYnVja2V0LmxhYmVsKTtcblxuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2VCdWNrZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVja2V0c1RvRGVsZXRlLnB1c2goYnVja2V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnVja2V0LmNvdW50ID0gdGhpcy5nZXRDb3VudFZhbHVlKHJlc3BvbnNlQnVja2V0KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnVja2V0O1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgaGFzU2VsZWN0aW9uID0gdGhpcy5zZWxlY3RlZEJ1Y2tldHNcbiAgICAgICAgICAgIC5maW5kKChzZWxCdWNrZXRzKSA9PiBhbHJlYWR5RXhpc3RpbmdGaWVsZC5sYWJlbCA9PT0gc2VsQnVja2V0cy5maWVsZC5sYWJlbCAmJiBhbHJlYWR5RXhpc3RpbmdGaWVsZC50eXBlID09PSBzZWxCdWNrZXRzLmZpZWxkLnR5cGUpO1xuXG4gICAgICAgIGlmICghaGFzU2VsZWN0aW9uICYmIGJ1Y2tldHNUb0RlbGV0ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGJ1Y2tldHNUb0RlbGV0ZS5mb3JFYWNoKChidWNrZXQpID0+IHtcbiAgICAgICAgICAgICAgICBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzLmRlbGV0ZUl0ZW0oYnVja2V0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzcG9uc2VCdWNrZXRzLmZvckVhY2goKHJlc3BCdWNrZXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQnVja2V0ID0gYWxyZWFkeUV4aXN0aW5nQnVja2V0cy5maW5kKChvbGRCdWNrZXQpID0+IG9sZEJ1Y2tldC5sYWJlbCA9PT0gcmVzcEJ1Y2tldC5sYWJlbCk7XG5cbiAgICAgICAgICAgIGlmICghZXhpc3RpbmdCdWNrZXQpIHtcbiAgICAgICAgICAgICAgICBhbHJlYWR5RXhpc3RpbmdGaWVsZC5idWNrZXRzLmFkZEl0ZW0ocmVzcEJ1Y2tldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2V0QnVja2V0RmlsdGVyRnVuY3Rpb24gKGJ1Y2tldExpc3QpIHtcbiAgICAgICAgcmV0dXJuIChidWNrZXQ6IEZhY2V0RmllbGRCdWNrZXQpOiBib29sZWFuID0+IHtcbiAgICAgICAgICAgIGlmIChidWNrZXQgJiYgYnVja2V0TGlzdC5maWx0ZXJUZXh0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF0dGVybiA9IChidWNrZXRMaXN0LmZpbHRlclRleHQgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgbGFiZWwgPSAodGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudChidWNrZXQuZGlzcGxheSkgfHwgdGhpcy50cmFuc2xhdGlvblNlcnZpY2UuaW5zdGFudChidWNrZXQubGFiZWwpKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5QnVpbGRlci5jb25maWcuZmlsdGVyV2l0aENvbnRhaW5zID8gbGFiZWwuaW5kZXhPZihwYXR0ZXJuKSAhPT0gLTEgOiBsYWJlbC5zdGFydHNXaXRoKHBhdHRlcm4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19